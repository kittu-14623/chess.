"use strict";var board,selected,turn,mode,gameOver,PIECE_MODELS={wK:"models/wK.glb",wQ:"models/wQ.glb",wR:"models/wR.glb",wB:"models/wB.glb",wN:"models/wN.glb",wP:"models/wP.glb",bK:"models/bK.glb",bQ:"models/bQ.glb",bR:"models/bR.glb",bB:"models/bB.glb",bN:"models/bN.glb",bP:"models/bP.glb"},PIECES={wK:"♔",wQ:"♕",wR:"♖",wB:"♗",wN:"♘",wP:"♙",bK:"♚",bQ:"♛",bR:"♜",bB:"♝",bN:"♞",bP:"♟"};function initialBoard(){return[["bR","bN","bB","bQ","bK","bB","bN","bR"],["bP","bP","bP","bP","bP","bP","bP","bP"],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],["wP","wP","wP","wP","wP","wP","wP","wP"],["wR","wN","wB","wQ","wK","wB","wN","wR"]]}function renderBoard(){var a=document.getElementById("chessboard");a.innerHTML="";for(var e=function(t){for(var e=function(e){var r=document.createElement("div");r.className="square "+((t+e)%2?"dark":"light"),r.dataset.row=t,r.dataset.col=e,selected&&selected[0]===t&&selected[1]===e&&r.classList.add("selected");var n=board[t][e];n&&(r.textContent=PIECES[n]),r.onclick=function(){return handleSquareClick(t,e)},a.appendChild(r)},r=0;r<8;r++)e(r)},r=0;r<8;r++)e(r);document.getElementById("turn-indicator").textContent=gameOver?"Game Over":("w"===turn?"White":"Black")+"'s turn"}function handleSquareClick(e,r){if(!gameOver){var n=board[e][r];if(selected){if(selected[0]===e&&selected[1]===r)return selected=null,void renderBoard();isValidMove(selected,[e,r],turn)?(movePiece(selected,[e,r]),selected=null,renderBoard(),"ai"!==mode||"b"!==turn||gameOver||setTimeout(aiMove,500)):(selected=null,renderBoard())}else n&&n[0]===turn&&(selected=[e,r],renderBoard())}}function movePiece(e,r){board[r[0]][r[1]]=board[e[0]][e[1]],board[e[0]][e[1]]=null,isCheckmate(opposite(turn))?(gameOver=!0,document.getElementById("turn-indicator").textContent=("w"===turn?"White":"Black")+" wins!"):turn=opposite(turn)}function opposite(e){return"w"===e?"b":"w"}function isValidMove(e,r,n){var t=board[e[0]][e[1]];if(!t||t[0]!==n)return!1;if(e[0]===r[0]&&e[1]===r[1])return!1;var a=board[r[0]][r[1]];if(a&&a[0]===n)return!1;var l=r[0]-e[0],o=r[1]-e[1];if(r[0]<0||7<r[0]||r[1]<0||7<r[1])return!1;if("P"===t[1]){var u="w"===n?-1:1;return 0==o&&l==u&&!a||(0==o&&l==2*u&&!a&&("w"===n&&6===e[0]||"b"===n&&1===e[0])&&!board[e[0]+u][e[1]]||!(1!==Math.abs(o)||l!=u||!a||a[0]===n))}if("N"===t[1])return 2===Math.abs(l)&&1===Math.abs(o)||1===Math.abs(l)&&2===Math.abs(o);if("B"===t[1]){if(Math.abs(l)!==Math.abs(o))return!1;for(var d=0<l?1:-1,b=0<o?1:-1,i=1;i<Math.abs(l);i++)if(board[e[0]+i*d][e[1]+i*b])return!1;return!0}if("R"===t[1]){if(0!=l&&0!=o)return!1;if(0==l){for(var s=0<o?1:-1,f=1;f<Math.abs(o);f++)if(board[e[0]][e[1]+f*s])return!1}else for(var c=0<l?1:-1,m=1;m<Math.abs(l);m++)if(board[e[0]+m*c][e[1]])return!1;return!0}if("Q"!==t[1])return"K"===t[1]&&(Math.abs(l)<=1&&Math.abs(o)<=1);if(Math.abs(l)===Math.abs(o)){for(var v=0<l?1:-1,w=0<o?1:-1,h=1;h<Math.abs(l);h++)if(board[e[0]+h*v][e[1]+h*w])return!1;return!0}if(0!=l&&0!=o)return!1;if(0==l){for(var P=0<o?1:-1,M=1;M<Math.abs(o);M++)if(board[e[0]][e[1]+M*P])return!1}else for(var B=0<l?1:-1,g=1;g<Math.abs(l);g++)if(board[e[0]+g*B][e[1]])return!1;return!0}function isCheckmate(e){for(var r=e+"K",n=0;n<8;n++)for(var t=0;t<8;t++)if(board[n][t]===r)return!1;return!0}function aiMove(){for(var e={K:1e3,Q:9,R:5,B:3,N:3,P:1},r=[],n=0;n<8;n++)for(var t=0;t<8;t++){var a=board[n][t];if(a&&"b"===a[0])for(var l=0;l<8;l++)for(var o=0;o<8;o++)if(isValidMove([n,t],[l,o],"b")){var u=0,d=board[l][o];d&&"w"===d[0]&&(u+=e[d[1]]||0);var b=board[l][o];board[l][o]=a;for(var i=!(board[n][t]=null),s=0;s<8;s++){for(var f=0;f<8;f++){var c=board[s][f];if(c&&"w"===c[0]&&isValidMove([s,f],[l,o],"w")){i=!1;break}}if(!i)break}board[n][t]=a,board[l][o]=b,i&&(u+=.5),r.push({from:[n,t],to:[l,o],score:u})}}if(0!==r.length){r.sort(function(e,r){return r.score-e.score});var m=r[0];movePiece(m.from,m.to),renderBoard()}}function setMode(e){mode=e,resetGame()}function resetGame(){board=initialBoard(),selected=null,gameOver=!(turn="w"),renderBoard(),"ai"===mode&&"b"===turn&&setTimeout(aiMove,500)}document.getElementById("mode-human").onclick=function(){return setMode("human")},document.getElementById("mode-ai").onclick=function(){return setMode("ai")},mode="human",resetGame();
//# sourceMappingURL=chess.min.js.map
